//Panos - Modified .class to .classes
(function(e){function n(){var e=this.options;s.call(this);if(e.filterModal)i.call(this);if(e.toggleColumns)r.call(this);if(e.allowOverflow)u.call(this);if(e.allowTableinfo)o.call(this);this.toolbar()}function r(){var t=this.options,n=this.$element,r=this.$top_details,i=e("<a></a>");var s=this;if(!this.$column_modal){this.$column_modal=e("<div></div>").attr("id","dt-column-modal_"+Math.floor(Math.random()*100+1)).addClass("modal").hide();this.$column_modalheader=e("<div></div>").addClass("modal-header").append(e("<button></button>").addClass("close").data("dismiss","modal").text("x").click(function(){s.$column_modal.modal("hide")})).append(e("<h3></h3>").text("Toggle Columns"));this.$column_modalfooter=e("<div></div>").addClass("modal-footer").append(e('<div class="pull-left"></div>').append(e('<div class="btn-group"></div>').append(e('<a href="#" class="btn">Check All</a>').click(function(){e(this).closest(".modal").find("a.active > i.icon-remove").each(function(){e(this).parent().click()});return false}),e('<a href="#" class="btn">None</a>').click(function(){e(this).closest(".modal").find("a.active > i.icon-ok").each(function(){e(this).parent().click()});return false}))),t.allowSaveColumns?e("<a></a>").attr("href","#").addClass("btn btn-primary").text("Save").click(function(){d.call(s);return false}):"",e("<a></a>").attr("href","#").addClass("btn").text("Close").click(function(){s.$column_modal.modal("hide");return false}));this.$column_modalbody=e("<div></div>").addClass("modal-body");this.$column_modal.append(this.$column_modalheader,this.$column_modalbody,this.$column_modalfooter).appendTo(document.body)}i.addClass("btn").data("toggle","modal").attr("title","Choose which columns you would like to display.").attr("href","#"+this.$column_modal.attr("id")).html('<i class="icon-cog"></i>').click(function(e){s.$column_modal.on("show",function(){h.call(s,s.$column_modalbody)}).modal();return false});this.buttons.unshift(i);return this.$column_modal}function i(){var t=this.options,n=this.$element,r=e("<a></a>");r.addClass("btn").data("toggle","modal").attr("href","#").attr("title","Open the filter dialog.").html('<i class="icon-filter"></i>').click(function(){if(e(t.filterModal).hasClass("modal"))e(t.filterModal).modal();else if(e(t.filterModal).is(":visible"))e(t.filterModal).hide();else e(t.filterModal).show();return false});this.buttons.unshift(r)}function s(){var t=this.options,n=this.$element,r=this;var i=e("<a></a>").addClass("btn dropdown-toggle").attr("title","Change the number of rows per page.").attr("data-toggle","dropdown").html(t.perPage+" ").css({fontWeight:"normal"}).append(e("<span></span>").addClass("caret"));this.buttons.push(i);var s=e("<ul></ul>").addClass("dropdown-menu").css({fontSize:"initial",fontWeight:"normal"}).append(e('<li data-value="5"><a href="#">5</a></li>').click(function(){f.call(this,r);return false}),e('<li data-value="10"><a href="#">10</a></li>').click(function(){f.call(this,r);return false}),e('<li data-value="20"><a href="#">20</a></li>').click(function(){f.call(this,r);return false}),e('<li data-value="50"><a href="#">50</a></li>').click(function(){f.call(this,r);return false}),e('<li data-value="100"><a href="#">100</a></li>').click(function(){f.call(this,r);return false}));this.buttons.push(s)}function o(){var t=this.options,n=this.$element,r=e("<a></a>");r.addClass("btn").attr("href","#").html('<i class="icon-info-sign"></i>').click(function(){return false});var i=[],s=[];e.each(t.sort,function(e,n){if(!n.length)return;var r;for(var s in t.columns){if(t.columns[s].field==n[0])r=t.columns[s].title}i.push(r+" "+n[1].toUpperCase())});e.each(t.filter,function(e,n){var r;for(var i in t.columns){if(t.columns[i].field==e)r=t.columns[i].title}s.push((r||e)+" = '"+n+"'")});e(r).popover({placement:"bottom",content:e("<dl></dl>").append(i.length>0?'<dt><i class="icon-th-list"></i> Sort:</dt><dd>'+i.join(", ")+"</dd>":"",s.length>0?'<dt><i class="icon-filter"></i> Filter:</dt><dd>'+s.join(", ")+"</dd>":"")});this.buttons.unshift(r)}function u(){var t=this.options,n=this.$wrapper,r=e("<a></a>");r.addClass("btn").attr("href","#").attr("title","Toggle the size of the table to fit the data or to fit the screen.").html('<i class="icon-resize-full"></i>').click(function(){if(n)a.call(this,n);return false});if(!this.resultset||!this.resultset.data||this.resultset.data.length==0)r.addClass("disabled");this.buttons.push(r)}function a(t){if(t.css("overflow")=="scroll"){e(this).children("i").attr("class","icon-resize-full");t.css({overflow:"visible",width:"auto"})}else{e(this).children("i").attr("class","icon-resize-small");t.css({overflow:"scroll",width:t.width()})}}function f(t){var n=t.options;n.perPage=e(this).data("value");var r=n.currentPage*n.perPage;while(r>n.totalRows){n.currentPage--;r=n.currentPage*n.perPage}if(n.currentPage<1)n.currentPage=1;if(e(this).popover)e(this).popover("hide");t.render();return false}function l(){var e=this.options,t=this.$element;t.empty();n.call(this);if(e.tableCallback&&typeof e.tableCallback==="function")e.tableCallback.call(this);this.loading(false);if(this.$default)t.append(this.$default)}function c(t){var n=t.options;n.filter[e(this).data("filter")]=e(this).val();if(n.debug)console.log(n.filter);t.render()}function h(t){var n=this.options,r=e("<fieldset></fieldset>"),i=this;for(var s in n.columns){if(n.columns[s].title==="")continue;var o=e('<div class="control-group" style="float: left" data-column="'+s+'"><label class="control-label">'+n.columns[s].title+'</label><div class="controls"><div class="btn-group" data-toggle="buttons-radio"><a href="#" class="btn '+(n.columns[s].hidden?"":"active")+'"><i class="icon-ok"></i></a><a href="#" class="btn '+(n.columns[s].hidden?"active":"")+'"><i class="icon-remove"></i></a></div></div></div>').click(function(){p.call(this,i);return false});r.append(o)}t.empty();t.append(e("<form></form>").addClass("form-horizontal").append(r))}function p(t){var n=t.options,r=e(this).data("column"),i=e("."+n.columns[r].classname);if(i.is(":visible")){i.hide();n.columns[r].hidden=true}else{i.show();n.columns[r].hidden=false}e(this).find("a.active").removeClass("active");n.columns[r].hidden?e(this).find(".icon-remove").parent().addClass("active"):e(this).find(".icon-ok").parent().addClass("active");return false}function d(){var t=this.options,n=[];if(localStorage){localStorage[this.localStorageId]=JSON.stringify(t.columns)}e.ajax({url:t.url,type:"POST",dataType:"json",data:e.extend({},t.post,{action:"save-columns",columns:JSON.stringify(t.columns),sort:JSON.stringify(t.sort),filter:JSON.stringify(t.filter)}),success:function(e){if(t.debug)console.log("columns saved")}});this.$column_modal.modal("hide")}function v(t){var n=this.options,r=t?JSON.parse(t):[],i=this.resultset;if(!i.columns)i.columns=[];for(column in n.columns){n.columns[column]=e.extend({},n.columns[column],i.columns[column],r[column])}}var t=function(t,r){this.$element=e(t);this.options=r;this.enabled=true;this.columns=[];this.rows=[];this.buttons=[];this.localStorageId="datatable_"+(r.id||r.url.replace(/\W/ig,"_"));for(var i in this.options.columns){if(typeof this.options.columns[i].sortable===undefined)this.options.columns[i].sortable=true}this.$default=this.$element.children().length?this.$element.children():e("<div></div>").addClass("alert alert-error").html("No Results Found");this.$element.addClass("clearfix");if(localStorage){localStorage[this.localStorageId]="false"}if(this.options.tablePreRender&&typeof this.options.tablePreRender==="function")this.options.tablePreRender.call(this);n.call(this);if(this.options.autoLoad===true)this.render()};t.prototype={constructor:t,render:function(){var t=this.options,r=this.$element;this.loading(true);this.columns=[];this.rows=[];this.buttons=[];this.$wrapper=undefined;this.$table=undefined;this.$header=undefined;this.$body=undefined;this.$footer=undefined;this.$pagination=undefined;if(this.$toolbar)this.$toolbar.remove();this.$top_details=e("<div></div>").attr("id","dt-top-details");this.$bottom_details=e("<div></div>").attr("id","dt-bottom-details");var i=this;if(t.url!==""){e.ajax({url:t.url,type:"POST",dataType:"json",data:e.extend({},t.post,{currentPage:t.currentPage,perPage:t.perPage,sort:t.sort,filter:t.filter}),success:function(e){if(t.debug)console.log(e);i.resultset=e;if(!e||e===undefined||!e.data||e.data.length==0){l.call(i);return}r.empty();t.sort=e.sort;t.filter=e.filter;t.totalRows=e.totalRows;if(e.currentPage)t.currentPage=parseInt(e.currentPage);v.call(i,localStorage[i.localStorageId]);r.append(i.table());r.prepend(i.$top_details);r.append(i.$bottom_details);if(t.showHeader)i.header();if(t.showFooter)i.footer();i.body();if(t.showTopPagination&&i.pagination())i.$top_details.append(i.pagination().clone(true));if(t.showPagination&&i.pagination())i.$bottom_details.append(i.pagination().clone(true));i.details();n.call(i);if(t.tableCallback&&typeof t.tableCallback==="function")t.tableCallback.call(i);i.loading(false)},error:function(e){if(t.debug)console.log(e);l.call(i);i.loading(false)}})}},loading:function(t){var n=this.$element;if(!this.$loading){this.$loading=e("<div></div>").css({position:"absolute",top:parseInt(n.position().top)+5,left:parseInt(n.position().left)+parseInt(n.css("marginLeft"))+Math.floor(n.width()/4),width:Math.floor(n.width()/2)+"px"}).append(e("<div></div>").addClass("progress progress-striped active").append(e('<div class="bar" style="width: 100%"></div>'))).appendTo(document.body)}if(t){n.css({opacity:.2})}else{n.css({opacity:1});this.$loading.remove();this.$loading=undefined}},toolbar:function(){var t=this.options,n=this.$element,r=this;this.$toolbar=e("<div></div>").addClass("dt-toolbar btn-toolbar pull-right");this.$button_group=e("<div></div>").addClass("btn-group").appendTo(this.$toolbar);for(var i=0;i<t.buttons.length;i++){this.buttons.push(t.buttons[i])}e.each(this.buttons,function(){r.$button_group.append(this)});if(t.sectionHeader){this.$section_header=e(t.sectionHeader);this.$section_header.append(this.$toolbar)}else if(t.title!==""&&!this.$section_header){this.$section_header=e("<h2></h2>").text(t.title).append(this.$toolbar);n.before(this.$section_header)}else{if(!this.$toolbar_container){this.$toolbar_container=e("<div></div>").addClass("dt-toolbar-container clearfix")}n.prepend(this.$toolbar_container.append(this.$toolbar))}return this.$toolbar},details:function(){var t=this.options,n=this.resultset,r=0,i=0,s=this;r=t.currentPage*t.perPage-t.perPage+1;if(r<1)r=1;i=t.currentPage*t.perPage;if(i>t.totalRows)i=t.totalRows;e('<div class="pull-left"><p>Showing '+r+" to "+i+" of "+t.totalRows+" twittos</p></div>").prependTo(this.$bottom_details)},table:function(){var t=this.$element,n=this.options;if(!this.$table_wrapper){this.$wrapper=e("<div></div>").addClass("dt-table-wrapper")}if(!this.$table){this.$table=e("<table></table>").addClass(n.classes)}this.$wrapper.append(this.$table);return this.$wrapper},header:function(){var t=this.options,n=this.resultset;if(!this.$header){this.$header=e("<thead></thead>");var r=e("<tr></tr>");for(var i in t.columns){var s=this.column(i),o=s.data("column_properties");if(o.sortable&&!o.custom)s.click(this,this.sort).css({cursor:"pointer"});for(var u=0;u<t.sort.length;u++){if(t.sort[u][0]==o.field){if(t.sort[u][1]=="asc"){s.append(e(t.ascending));o.sortOrder="asc"}else if(t.sort[u][1]=="desc"){s.append(e(t.descending));o.sortOrder="desc"}}}r.append(s);this.$header.append(r);this.columns.push(s)}if(t.headerCallback&&typeof t.headerCallback==="function")t.headerCallback.call(this);this.$table.append(this.$header)}return this.$header},footer:function(){var t=this.options,n=this.resultset;if(!this.$footer){this.$footer=e("<tfoot></tfoot>");for(column in t.columns){var r=e("<td></td>");r.data("cell_properties",t.columns[column]).addClass(t.columns[column].classname);this.$footer.append(r)}if(t.footerCallback&&typeof t.footerCallback==="function")t.footerCallback.call(this,this.resultset.footer);this.$table.append(this.$footer)}return this.$footer},body:function(){var t=this.resultset,n=this.options;if(!this.$body){this.$body=e("<tbody></tbody>");for(var r=0;r<t.data.length;r++){var i=this.row(t.data[r]);this.$body.append(i);this.rows.push(i)}if(n.showFilterRow)this.$body.prepend(this.filter());this.$table.append(this.$body)}return this.$body},filter:function(){var t=e("<tr></tr>"),n=this.options,r=this;t.addClass("dt-filter-row");for(var i in n.columns){var s=e("<td></td>").addClass(n.columns[i].classname);if(n.columns[i].hidden)s.hide();if(n.columns[i].filter&&n.columns[i].field){s.append(e("<input/>").attr("name","filter_"+n.columns[i].field).data("filter",n.columns[i].field).val(n.filter[n.columns[i].field]||"").change(function(e){c.call(this,r)}))}t.append(s)}return t},row:function(t){var n=e("<tr></tr>"),r=this.options;for(var i in r.columns){var s=this.cell(t,i);n.append(s)}if(r.rowCallback&&typeof r.rowCallback==="function")n=r.rowCallback(n,t);return n},cell:function(t,n){var r=t[this.options.columns[n].field]||this.options.columns[n].custom,i=e("<td></td>"),s=this.options;if(s.columns[n].callback&&typeof s.columns[n].callback==="function")r=s.columns[n].callback.call(i,t,s.columns[n]);i.data("cell_properties",s.columns[n]).addClass(s.columns[n].classname).append(r||" ");if(s.columns[n].css)i.css(s.columns[n].css);if(s.columns[n].hidden)i.hide();return i},column:function(t){var n=e("<th></th>"),r=this.options,i="dt-column_"+t+Math.floor(Math.random()*1e3+1);r.columns[t].classname=i;n.data("column_properties",r.columns[t]).addClass(i).text(r.columns[t].title);if(r.columns[t].css)n.css(r.columns[t].css);if(r.columns[t].hidden)n.hide();return n},sort:function(t){var n=e(this).data("column_properties"),r=t.data,i=t.data.options,s=false;n.sortOrder=n.sortOrder?n.sortOrder=="asc"?"desc":"":"asc";if(i.allowMultipleSort){for(var o=0;o<i.sort.length;o++){if(i.sort[o][0]==n.field){i.sort[o][1]=n.sortOrder;if(n.sortOrder==="")i.sort.splice(o,1);s=true}}if(!s)i.sort.push([n.field,n.sortOrder])}else{i.sort=[];i.sort.push([n.field,n.sortOrder])}if(i.debug)console.log(i.sort);r.render()},pagination:function(){var t=this.$element,n=this,r=this.options,i=this.resultset;if(r.perPage>=i.totalRows)return;if(!this.$pagination){this.$pagination=e("<div></div>").addClass("pagination pagination-right");r.pageCount=Math.ceil(i.totalRows/r.perPage);var s=e("<ul></ul>"),o=e("<li></li>").append(e("<a></a>").attr("href","#").data("page",1).html("← First").click(function(){r.currentPage=1;n.render();return false})),u=e("<li></li>").append(e("<a></a>").attr("href","#").data("page",r.currentPage-1).text("Prev").click(function(){r.currentPage-=1;r.currentPage=r.currentPage>=1?r.currentPage:1;n.render();return false})),a=e("<li></li>").append(e("<a></a>").attr("href","#").data("page",r.currentPage+1).text("Next").click(function(){r.currentPage+=1;r.currentPage=r.currentPage<=r.pageCount?r.currentPage:r.pageCount;n.render();return false})),f=e("<li></li>").append(e("<a></a>").attr("href","#").data("page",r.pageCount).html("Last →").click(function(){r.currentPage=r.pageCount;n.render();return false}));var l=r.pagePadding*2,c,h;if(l>=r.pageCount){c=1;h=r.pageCount}else{c=r.currentPage-r.pagePadding;if(c<=0)c=1;h=c+l;if(h>r.pageCount){h=r.pageCount;c=h-l}}for(var p=c;p<=h;p++){var d=e("<li></li>").append(e("<a></a>").attr("href","#").data("page",p).text(p).click(function(){r.currentPage=e(this).data("page");n.render();return false}));if(p==r.currentPage)d.addClass("active");s.append(d)}if(r.currentPage==1){o.addClass("disabled");u.addClass("disabled")}if(r.currentPage==r.pageCount){a.addClass("disabled");f.addClass("disabled")}s.prepend(o,u);s.append(a,f);this.$pagination.append(s)}return this.$pagination},remove:function(){var e=this.$element;if(this.$section_header)this.$section_header.remove();e.data("datatable",null);e.empty()}};e.fn.datatable=function(n){e.fn.datatable.init.call(this,n,t,"datatable");return this};e.fn.datatable.init=function(t,n,r){function s(i){var s=e.data(i,r);if(!s){s=new n(i,e.fn.datatable.elementOptions(i,t));e.data(i,r,s)}return s}var i;if(t===true){return this.data(r)}else if(typeof t=="string"){i=this.data(r);if(i){i[t]()}return this}t=e.extend({},e.fn[r].defaults,t);this.each(function(){s(this)});return this};e.fn.datatable.DataTable=t;e.fn.datatable.elementOptions=function(t,n){return e.metadata?e.extend({},n,e(t).metadata()):n};e.fn.datatable.defaults={debug:false,id:undefined,title:"Data Table Results",classes:"table table-striped table-bordered",perPage:10,pagePadding:2,sort:[[]],filter:{},post:{},buttons:[],sectionHeader:undefined,totalRows:0,currentPage:1,showPagination:false,showTopPagination:false,showHeader:true,showFooter:false,showFilterRow:false,filterModal:undefined,allowExport:false,allowOverflow:true,allowMultipleSort:false,allowSaveColumns:false,toggleColumns:true,url:"",columns:[],ascending:'<i class="icon-chevron-up"></i>',descending:'<i class="icon-chevron-down"></i>',rowCallback:undefined,tableCallback:undefined,headerCallback:undefined,footerCallback:undefined,tablePreRender:undefined,autoLoad:true}})(window.jQuery)
